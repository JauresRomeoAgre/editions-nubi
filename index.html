<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>√âditions Nubi ‚Äì Le Petit Nuage Qui Avait Peur de Pleuvoir</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="√âditions Nubi, maison d‚Äô√©dition jeunesse ind√©pendante.">
  <style>
    :root {
      --bleu-ciel: #8ec5fc;
      --bleu-nuit: #152238;
      --jaune-doux: #ffe3a3;
      --rose-doux: #ffd6e8;
      --texte: #222;
      --fond: #f7f9fc;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--fond);
      color: var(--texte);
      line-height: 1.6;
    }
    /* --- STYLES HEADER & NAV --- */
    header {
      background: linear-gradient(135deg, var(--bleu-ciel), var(--rose-doux));
      color: #fff;
      padding: 2.5rem 1.5rem 3.5rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    header::after {
      content: "";
      position: absolute;
      inset: auto -20% -8rem;
      height: 10rem;
      background: radial-gradient(circle at 50% 0%, rgba(255,255,255,0.9), transparent 60%);
      opacity: 0.9;
    }
    .wrapper {
      max-width: 1060px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      gap: 1rem;
      flex-wrap: wrap;
    }
    nav .logo {
      font-weight: 700;
      font-size: 1.1rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }
    nav ul {
      list-style: none;
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    nav a {
      color: #fff;
      text-decoration: none;
      font-size: 0.95rem;
      opacity: 0.9;
    }
    nav a:hover { opacity: 1; text-decoration: underline; }

    /* --- HERO --- */
    .hero {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.5fr);
      gap: 2rem;
      align-items: center;
      margin-top: 1.5rem;
    }
    .hero-text h1 {
      font-size: clamp(2rem, 3vw, 2.6rem);
      margin-bottom: 0.8rem;
    }
    .hero-text p {
      font-size: 1rem;
      max-width: 32rem;
      margin-bottom: 1.5rem;
    }
    .tagline {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      opacity: 0.9;
      margin-bottom: 0.5rem;
    }
    .btn-primary, .btn-ghost, .btn-order {
      display: inline-block;
      padding: 0.8rem 1.3rem;
      border-radius: 999px;
      border: 0;
      cursor: pointer;
      font-size: 0.95rem;
      text-decoration: none;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      margin-right: 0.5rem;
    }
    .btn-primary {
      background: #fff;
      color: var(--bleu-nuit);
      box-shadow: 0 8px 18px rgba(0,0,0,0.18);
      font-weight: 600;
    }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 12px 24px rgba(0,0,0,0.22); }
    .btn-ghost {
      background: rgba(255,255,255,0.18);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.5);
    }
    .btn-ghost:hover { background: rgba(255,255,255,0.3); }
    .btn-order {
      background: #2563eb;
      color: #fff;
      font-weight: 600;
      box-shadow: 0 8px 20px rgba(37,99,235,0.35);
      margin-top: 0.8rem;
      border: none;
    }
    .btn-order:hover { transform: translateY(-1px); box-shadow: 0 12px 26px rgba(37,99,235,0.45); }

    .hero-book {
      background: rgba(255,255,255,0.95);
      border-radius: 1.5rem;
      padding: 1.5rem;
      box-shadow: 0 18px 40px rgba(0,0,0,0.22);
    }
    .hero-book .badge {
      display: inline-block;
      background: var(--jaune-doux);
      color: #9a5a00;
      padding: 0.3rem 0.7rem;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 0.6rem;
    }
    .hero-book-title { font-weight: 700; margin-bottom: 0.2rem; }
    .hero-book-sub { font-size: 0.9rem; margin-bottom: 0.8rem; color: #555; }
    .hero-cover {
      margin-top: 0.8rem;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(15,23,42,0.25);
    }
    .hero-cover img { display: block; width: 100%; height: auto; }

    /* --- SECTIONS --- */
    section { padding: 3rem 1.5rem; }
    section:nth-of-type(odd) { background: #ffffff; }
    section:nth-of-type(even) { background: var(--fond); }
    section h2 { font-size: 1.6rem; margin-bottom: 1rem; text-align: center; }
    section p.lead { text-align: center; max-width: 620px; margin: 0 auto 2rem; color: #555; font-size: 0.98rem; }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }
    .card {
      background: #fff;
      border-radius: 1.1rem;
      padding: 1.4rem;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
    }
    .card h3 { font-size: 1.05rem; margin-bottom: 0.6rem; }
    .meta-list { list-style: none; font-size: 0.95rem; }
    .meta-list li { margin-bottom: 0.25rem; }

    .contact-block {
      max-width: 480px; margin: 0 auto; text-align: center; font-size: 0.98rem;
    }
    .contact-block a { color: var(--bleu-nuit); text-decoration: none; font-weight: 600; }
    
    footer {
      text-align: center; padding: 1.5rem 1rem 2rem; font-size: 0.85rem; color: #777; background: #ffffff;
    }

    /* --- FORMULAIRE --- */
    form.card label { display:block; margin-top:0.9rem; margin-bottom:0.25rem; font-size:0.9rem; font-weight: 600; color: #333; }
    form.card select, form.card input {
      width:100%; padding:0.5rem 0.7rem; border-radius:0.4rem; border:1px solid #cdd2e0; font-size:0.95rem; background: #fff;
    }
    form.card select:focus, form.card input:focus {
        border-color: #2563eb; outline: none; box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
    }
    
    .hidden { display: none; }
    .form-section-title {
        margin-top: 1.5rem; margin-bottom: 0.5rem; font-size: 1rem; font-weight: 700; color: var(--bleu-nuit); border-bottom: 2px solid #f0f0f0; padding-bottom: 0.3rem;
    }
    
    @media (max-width: 780px) {
      .hero { grid-template-columns: 1fr; }
      nav { justify-content: center; }
      nav .logo { width: 100%; text-align: center; }
      header { padding-bottom: 3rem; }
    }
  </style>
</head>
<body>

<header id="top">
  <div class="wrapper">
    <nav>
      <div class="logo">√âditions Nubi</div>
      <ul>
        <li><a href="#livre">Le livre</a></li>
        <li><a href="#pro">Librairies</a></li>
        <li><a href="#contact">Contact</a></li>
      </ul>
    </nav>

    <div class="hero">
      <div class="hero-text">
        <div class="tagline">Albums jeunesse illustr√©s</div>
        <h1>Des histoires douces pour apprivoiser les √©motions.</h1>
        <p>
          √âditions Nubi publie des albums jeunesse lumineux, sensibles et rassurants.
          Notre premier titre, <strong>Le Petit Nuage Qui Avait Peur de Pleuvoir</strong>,
          accompagne les enfants dans la d√©couverte de leur sensibilit√©.
        </p>
        <a href="#livre" class="btn-primary">D√©couvrir l‚Äôalbum</a>
      </div>

      <div class="hero-book">
        <span class="badge">Nouveaut√©</span>
        <div class="hero-book-title">Le Petit Nuage Qui Avait Peur de Pleuvoir</div>
        <div class="hero-book-sub">Album jeunesse 21√ó27 cm ‚Äì 40 pages couleur</div>
        <div class="hero-cover">
          <img src="ImageNubi.png" alt="Couverture du livre" />
        </div>
        <a href="#commande" class="btn-order">Commander</a>
      </div>
    </div>
  </div>
</header>

<section id="livre">
  <div class="wrapper">
    <h2>Le Petit Nuage Qui Avait Peur de Pleuvoir</h2>
    <p class="lead">Un album tendre et po√©tique pour aider les enfants √† apprivoiser leurs √©motions.</p>
    <div class="grid">
      <div class="card">
        <h3>L‚Äôhistoire</h3>
        <p>Nubi est le plus petit nuage du ciel. Timide et tr√®s sensible, il a peur de pleuvoir trop fort...</p>
      </div>
      <div class="card">
        <h3>Caract√©ristiques</h3>
        <ul class="meta-list">
          <li><strong>√Çge :</strong> D√®s 3 ans</li>
          <li><strong>Format :</strong> 21 √ó 27 cm</li>
          <li><strong>Prix public :</strong> 14,49 ‚Ç¨ HT</li>
        </ul>
        <a href="#commande" class="btn-order">Commander</a>
      </div>
    </div>
  </div>
</section>

<section id="commande">
  <div class="wrapper">
    <h2>Commander un livre</h2>
    <p class="lead">Remplissez ce formulaire pour configurer votre commande.</p>

    <form id="commandeForm" class="card" style="max-width: 700px; margin: 0 auto;">
      
      <div class="form-section-title">Localisation</div>
      <label for="region">R√©gion</label>
      <select id="region" name="region">
        <option value="">Choisissez une r√©gion</option>
        <option value="afrique">Afrique</option>
        <option value="europe">Europe</option>
        <option value="amerique">Am√©rique</option>
        <option value="asie">Asie</option>
      </select>

      <label for="pays">Pays</label>
      <select id="pays" name="pays">
        <option value="">Choisissez d‚Äôabord une r√©gion</option>
      </select>

      <div id="zone-ci-block" class="hidden">
        <label for="zoneCI">Zone (C√¥te d‚ÄôIvoire)</label>
        <select id="zoneCI" name="zoneCI">
          <option value="">Choisissez une zone</option>
          <option value="Abidjan">Abidjan</option>
          <option value="Bingerville">Bingerville</option>
          <option value="Dabou">Dabou</option>
          <option value="Interieur">Int√©rieur</option>
        </select>
        <div id="ville-interieur-block" style="margin-top:0.5rem;" class="hidden">
          <label for="villeInterieur">Ville (int√©rieur)</label>
          <input type="text" id="villeInterieur" name="villeInterieur" placeholder="Nom de la ville" />
        </div>
      </div>

      <div class="form-section-title">Vos informations</div>
      
      <label for="statut">Vous √™tes‚Ä¶</label>
      <select id="statut" name="statut">
        <option value="">Choisissez un statut</option>
        <option value="parent">Parent</option>
        <option value="psy">Psychologue pour enfants</option>
        <option value="librairie">Librairie</option>
        <option value="bibliotheque">Biblioth√®que</option>
        <option value="ecole">√âcole</option>
        <option value="autre">Autre</option>
      </select>

      <div id="identite-block" class="hidden">
        
        <div id="type-ecole-block" class="hidden">
           <label for="typeEcole">Type d'√©cole</label>
           <select id="typeEcole">
             <option value="">Selectionnez...</option>
             <option value="Maternelle">Maternelle</option>
             <option value="Primaire">Primaire</option>
           </select>
        </div>

        <div id="structure-block" class="hidden">
            <label for="nomStructure" id="lbl-structure">Nom de l'√©tablissement</label>
            <input type="text" id="nomStructure" placeholder="" />
        </div>

        <div style="display:flex; gap:1rem; align-items:flex-end; flex-wrap:wrap;">
            <div style="flex:1; min-width:120px;">
                <label for="genre">Genre</label>
                <select id="genre">
                    <option value="">Choix...</option>
                    <option value="Monsieur">Monsieur</option>
                    <option value="Madame">Madame</option>
                    <option value="Mademoiselle">Mademoiselle</option>
                    <option value="Autre">Autre</option>
                </select>
            </div>
            <div style="flex:2; min-width:180px;">
                <label for="nomFamille">Nom</label>
                <input type="text" id="nomFamille" />
            </div>
        </div>
        <label for="prenoms">Pr√©nom(s)</label>
        <input type="text" id="prenoms" />

        <div id="poste-block" class="hidden">
            <label for="poste">Poste occup√©</label>
            <select id="poste"></select>
            <div id="poste-perso-block" class="hidden" style="margin-top:0.5rem;">
                <input type="text" id="posteAutre" placeholder="Pr√©cisez votre poste..." />
            </div>
        </div>

        <label for="adresse" id="lbl-adresse">Adresse</label>
        <input type="text" id="adresse" placeholder="Quartier, Rue, Porte..." />

        <label for="contactTel">Contact</label>
        <div style="display:flex; gap:0.5rem; align-items:center;">
          <span id="indicatif" style="background:#eee; padding:0.5rem; border-radius:0.4rem; font-weight:bold; color:#555;">+225</span>
          <input type="tel" id="contactTel" placeholder="Num√©ro" />
        </div>

        <label for="emailContact" id="lbl-email">E-mail</label>
        <input type="email" id="emailContact" placeholder="nom@exemple.com" />

      </div>

      <div class="form-section-title">D√©tails de la commande</div>

      <label for="livre">Livre souhait√©</label>
      <select id="livre" name="livre">
        <option value="Le Petit Nuage Qui Avait Peur de Pleuvoir">Le Petit Nuage Qui Avait Peur de Pleuvoir</option>
      </select>

      <div id="quantite-block">
        <label for="quantite">Quantit√©</label>
        <select id="quantite" name="quantite">
             <option value="">Remplissez d'abord votre statut</option>
        </select>
        <div id="quantite-pers-block" class="hidden" style="margin-top:0.5rem;">
          <label for="quantitePerso">Quantit√© personnalis√©e</label>
          <input type="number" id="quantitePerso" min="1" step="1" />
        </div>
      </div>

      <div style="margin-top:1rem;">
        <label for="devise">Devise</label>
        <select id="devise" name="devise">
          <option value="">Choisissez une devise</option>
          <option value="EUR">Euro (‚Ç¨)</option>
          <option value="USD">Dollar ($)</option>
          <option value="XOF">Franc CFA (FCFA)</option>
        </select>
      </div>
      <div style="margin-top:0.5rem;">
        <label for="total">Total HT</label>
        <input type="text" id="total" readonly style="background-color: #f0f0f0; font-weight: bold;" />
      </div>

      <div style="margin-top:2rem; border-top: 2px solid #f0f0f0; padding-top: 1.5rem;">
        <strong>Envoyer la commande via :</strong>
        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
            <button type="button" id="btnWhatsapp" class="btn-order" style="background:#25D366; flex:1;">
                WhatsApp
            </button>
            <button type="button" id="btnEmail" class="btn-order" style="background:#ea4335; flex:1;">
                E-mail
            </button>
        </div>
      </div>

      <p id="msgInfo" style="margin-top:0.8rem; font-size:0.85rem; color:#555; text-align: center;"></p>
    </form>

    <div id="confirmationCard" class="card hidden" style="max-width:700px; margin:1.5rem auto 0; text-align:center;">
      <h3>Merci pour votre commande !</h3>
      <p id="confirmationTexte" style="margin-top:0.8rem; font-size:0.95rem;"></p>
      <a href="#top" class="btn-primary" style="margin-top:1rem; display:inline-block;">Retour √† l‚Äôaccueil</a>
    </div>
  </div>
</section>

<section id="contact">
  <div class="wrapper">
    <h2>Contact</h2>
    <div class="contact-block">
      <p><strong>√âditions Nubi</strong></p>
      <p>üìß <a href="mailto:contact@editionsnubi.com">contact@editionsnubi.com</a></p>
      <p>üìû <a href="tel:+2250709850776">+225 0709850776</a></p>
    </div>
  </div>
</section>

<footer>
  ¬© <span id="year"></span> √âditions Nubi ‚Äî Tous droits r√©serv√©s.
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
  
  // --- HELPERS ---
  function el(id) { return document.getElementById(id); }
  function show(id) { const e = el(id); if(e) e.classList.remove('hidden'); }
  function hide(id) { const e = el(id); if(e) e.classList.add('hidden'); }

  // --- CONFIGURATION ---
  const yearSpan = el('year');
  if(yearSpan) yearSpan.textContent = new Date().getFullYear();

  const EMAIL_DESTINATION = "contact@editionsnubi.com";
  const WHATSAPP_DESTINATION = "2250709850776";

  const paysParRegion = {
    afrique: ["C√¥te d'Ivoire", "S√©n√©gal", "Mali", "Burkina Faso", "Togo", "B√©nin", "Guin√©e", "Cameroun", "Congo", "RDC", "Maroc", "Alg√©rie", "Tunisie"],
    europe: ["France", "Belgique", "Suisse", "Allemagne", "Espagne", "Italie", "Portugal", "Pays-Bas"],
    amerique: ["Canada", "√âtats-Unis", "Br√©sil", "Mexique"],
    asie: ["Chine", "Japon", "Inde", "Cor√©e du Sud", "√âmirats Arabes Unis"]
  };

  const configTel = {
    "C√¥te d'Ivoire": { code: "+225", len: 10 }, "S√©n√©gal": { code: "+221", len: 9 }, "Mali": { code: "+223", len: 8 }, 
    "Burkina Faso": { code: "+226", len: 8 }, "Togo": { code: "+228", len: 8 }, "B√©nin": { code: "+229", len: 8 }, 
    "Guin√©e": { code: "+224", len: 9 }, "Cameroun": { code: "+237", len: 9 }, "Congo": { code: "+242", len: 9 }, 
    "RDC": { code: "+243", len: 9 }, "Maroc": { code: "+212", len: 9 }, "Alg√©rie": { code: "+213", len: 9 }, "Tunisie": { code: "+216", len: 8 },
    "France": { code: "+33", len: 10 }, "Belgique": { code: "+32", len: 9 }, "Suisse": { code: "+41", len: 9 }, 
    "Allemagne": { code: "+49", len: 10 }, "Espagne": { code: "+34", len: 9 }, "Italie": { code: "+39", len: 10 }, 
    "Portugal": { code: "+351", len: 9 }, "Pays-Bas": { code: "+31", len: 9 },
    "Canada": { code: "+1", len: 10 }, "√âtats-Unis": { code: "+1", len: 10 }, "Br√©sil": { code: "+55", len: 11 }, 
    "Mexique": { code: "+52", len: 10 }, "Chine": { code: "+86", len: 11 }, "Japon": { code: "+81", len: 10 }, 
    "Inde": { code: "+91", len: 10 }, "Cor√©e du Sud": { code: "+82", len: 10 }, "√âmirats Arabes Unis": { code: "+971", len: 9 }
  };

  // Options pour les postes
  const postesConfig = {
      librairie: ["G√©rant(e)", "Responsable Rayon Jeunesse", "Vendeur / Vendeuse", "Acheteur / Acheteuse", "personnaliser"],
      bibliotheque: ["Directeur / Directrice", "Biblioth√©caire", "Responsable Section Jeunesse", "B√©n√©vole", "personnaliser"],
      ecoleMaternelle: ["Directeur / Directrice", "Instituteur / Institutrice", "ATSEM", "Membre APE", "personnaliser"],
      ecolePrimaire: ["Directeur / Directrice", "Instituteur / Institutrice", "Documentaliste", "Membre APE", "personnaliser"]
  };

  // --- LOGIQUE REGION / PAYS ---
  const regionSelect = el('region');
  const paysSelect = el('pays');
  
  if(regionSelect && paysSelect) {
      regionSelect.addEventListener('change', () => {
        const region = regionSelect.value;
        paysSelect.innerHTML = '<option value="">Choisissez un pays</option>';
        hide('zone-ci-block'); hide('ville-interieur-block');
        
        if (region && paysParRegion[region]) {
          paysParRegion[region].forEach(p => {
            const opt = document.createElement('option');
            opt.value = p; opt.textContent = p;
            paysSelect.appendChild(opt);
          });
        }
      });

      paysSelect.addEventListener('change', () => {
        const pays = paysSelect.value;
        // Gestion Zone CI
        if (regionSelect.value === 'afrique' && pays === "C√¥te d'Ivoire") show('zone-ci-block');
        else { hide('zone-ci-block'); hide('ville-interieur-block'); }

        // Gestion Indicatif T√©l√©phone
        const conf = configTel[pays] || { code: "+", len: 0 };
        const indicatif = el('indicatif');
        const contactTel = el('contactTel');
        if(indicatif) indicatif.textContent = conf.code;
        if(contactTel) {
            contactTel.value = "";
            contactTel.placeholder = conf.len > 0 ? `Num√©ro (${conf.len} chiffres)` : "Num√©ro de t√©l√©phone";
            if(conf.len > 0) contactTel.setAttribute('maxlength', conf.len);
            else contactTel.removeAttribute('maxlength');
        }
      });
  }

  const zoneCISelect = el('zoneCI');
  if(zoneCISelect) {
      zoneCISelect.addEventListener('change', () => {
          if(zoneCISelect.value === 'Interieur') show('ville-interieur-block');
          else hide('ville-interieur-block');
      });
  }

  // --- LOGIQUE STATUT ET CHAMPS DYNAMIQUES ---
  const statutSelect = el('statut');
  
  function updateFormFields() {
      if(!statutSelect) return;
      const st = statutSelect.value;
      
      // Reset visibilit√©
      hide('identite-block');
      hide('structure-block');
      hide('type-ecole-block');
      hide('poste-block');
      
      const lblAdresse = el('lbl-adresse');
      const lblEmail = el('lbl-email');
      const lblStructure = el('lbl-structure');
      
      if(!st) return; // Si vide

      show('identite-block'); // Affiche le bloc global

      // Textes par d√©faut
      if(lblAdresse) lblAdresse.textContent = "Adresse";
      if(lblEmail) lblEmail.textContent = "Votre e-mail";

      // Logique sp√©cifique
      if(st === 'parent' || st === 'autre') {
          // Rien de sp√©cial, juste identit√© de base
      } 
      else if (st === 'psy') {
          show('structure-block');
          if(lblStructure) lblStructure.textContent = "Cabinet";
          if(lblAdresse) lblAdresse.textContent = "Adresse du cabinet";
          if(lblEmail) lblEmail.textContent = "E-mail du cabinet";
      }
      else if (st === 'librairie') {
          show('structure-block');
          show('poste-block');
          if(lblStructure) lblStructure.textContent = "Nom de la librairie";
          if(lblAdresse) lblAdresse.textContent = "Adresse de la librairie";
          if(lblEmail) lblEmail.textContent = "E-mail de la librairie";
          fillPosteOptions(postesConfig.librairie);
      }
      else if (st === 'bibliotheque') {
          show('structure-block');
          show('poste-block');
          if(lblStructure) lblStructure.textContent = "Nom de la biblioth√®que";
          if(lblAdresse) lblAdresse.textContent = "Adresse de la biblioth√®que";
          if(lblEmail) lblEmail.textContent = "E-mail de la biblioth√®que";
          fillPosteOptions(postesConfig.bibliotheque);
      }
      else if (st === 'ecole') {
          show('type-ecole-block');
          show('structure-block');
          show('poste-block');
          if(lblStructure) lblStructure.textContent = "Nom de l'√©cole";
          if(lblAdresse) lblAdresse.textContent = "Adresse de l'√©cole";
          if(lblEmail) lblEmail.textContent = "E-mail de l'√©cole";
          // Les options de poste seront mises √† jour quand on choisit le type d'√©cole
          fillPosteOptions([]); 
      }

      majQuantites(); // Met aussi √† jour les choix de quantit√©
  }

  if(statutSelect) statutSelect.addEventListener('change', updateFormFields);

  // Gestion Type Ecole
  const typeEcoleSelect = el('typeEcole');
  if(typeEcoleSelect) {
      typeEcoleSelect.addEventListener('change', () => {
          if(statutSelect.value === 'ecole') {
              if(typeEcoleSelect.value === 'Maternelle') fillPosteOptions(postesConfig.ecoleMaternelle);
              else if(typeEcoleSelect.value === 'Primaire') fillPosteOptions(postesConfig.ecolePrimaire);
              else fillPosteOptions([]);
          }
      });
  }

  // Gestion Poste
  const posteSelect = el('poste');
  function fillPosteOptions(arr) {
      if(!posteSelect) return;
      posteSelect.innerHTML = '<option value="">Selectionnez...</option>';
      arr.forEach(optVal => {
          const opt = document.createElement('option');
          opt.value = optVal;
          opt.textContent = (optVal === 'personnaliser') ? 'Autre (pr√©ciser)...' : optVal;
          posteSelect.appendChild(opt);
      });
  }

  if(posteSelect) {
      posteSelect.addEventListener('change', () => {
          if(posteSelect.value === 'personnaliser') show('poste-perso-block');
          else hide('poste-perso-block');
      });
  }

  // --- LOGIQUE QUANTIT√âS & PRIX ---
  const quantiteSelect = el('quantite');
  const quantitePersInput = el('quantitePerso');
  const deviseSelect = el('devise');
  const totalInput = el('total');

  function majQuantites() {
      if(!quantiteSelect || !statutSelect) return;
      const st = statutSelect.value;
      quantiteSelect.innerHTML = '';
      hide('quantite-pers-block');
      if(quantitePersInput) quantitePersInput.value = '';

      let opts = [];
      // Quantit√©s adapt√©es
      if (['librairie', 'ecole', 'bibliotheque'].includes(st)) {
          opts = ['5','10','20','30','50','personnaliser'];
      } else if (['parent', 'psy', 'autre'].includes(st)) {
          opts = ['1','2','3','5','7','10','personnaliser'];
      } else {
          // Si pas de statut
          const o = document.createElement('option');
          o.text = "Remplissez d'abord votre statut";
          quantiteSelect.add(o);
          return;
      }

      opts.forEach(v => {
          const o = document.createElement('option');
          o.value = v; o.text = (v === 'personnaliser') ? 'Autre quantit√©...' : v;
          quantiteSelect.add(o);
      });
      // Par d√©faut selectionner le premier
      quantiteSelect.selectedIndex = 0;
      calculerTotal();
  }

  if(quantiteSelect) {
      quantiteSelect.addEventListener('change', () => {
          if(quantiteSelect.value === 'personnaliser') show('quantite-pers-block');
          else hide('quantite-pers-block');
          if(quantiteSelect.value !== 'personnaliser' && quantitePersInput) quantitePersInput.value = '';
          calculerTotal();
      });
  }

  if(quantitePersInput) quantitePersInput.addEventListener('input', calculerTotal);
  if(deviseSelect) deviseSelect.addEventListener('change', calculerTotal);

  function getQuantite() {
      if(!quantiteSelect) return 0;
      if(quantiteSelect.value === 'personnaliser') {
          const q = parseInt(quantitePersInput ? quantitePersInput.value : 0);
          return isNaN(q) ? 0 : q;
      }
      return parseInt(quantiteSelect.value || 0);
  }

  function calculerTotal() {
      if(!totalInput || !deviseSelect) return;
      const qte = getQuantite();
      let unit = 0;
      if(deviseSelect.value === 'EUR') unit = 14.49;
      if(deviseSelect.value === 'USD') unit = 16.99;
      if(deviseSelect.value === 'XOF') unit = 10000;

      if(!qte || !unit) { totalInput.value = ''; return; }
      
      const total = qte * unit;
      if(deviseSelect.value === 'XOF') totalInput.value = total.toLocaleString('fr-FR') + ' FCFA';
      else if(deviseSelect.value === 'EUR') totalInput.value = total.toFixed(2).replace('.', ',') + ' ‚Ç¨';
      else totalInput.value = total.toFixed(2) + ' $';
  }

  // --- TRAITEMENT ENVOI ---
  function traiterEnvoi(modeEnvoi) {
      const msgInfo = el('msgInfo');
      const confirmationCard = el('confirmationCard');
      const confirmationTexte = el('confirmationTexte');
      const commandeForm = el('commandeForm');
      
      try {
          if(msgInfo) { msgInfo.textContent = ""; msgInfo.style.color = "#555"; }

          // 1. Validation de base
          const region = regionSelect ? regionSelect.value : '';
          const pays = paysSelect ? paysSelect.value : '';
          if(!region || !pays) throw "Veuillez s√©lectionner la r√©gion et le pays.";

          // Zone CI
          let detailsZone = "";
          if(region === 'afrique' && pays === "C√¥te d'Ivoire") {
              const zone = el('zoneCI').value;
              if(!zone) throw "Veuillez pr√©ciser la zone en C√¥te d'Ivoire.";
              if(zone === 'Interieur') {
                  const ville = el('villeInterieur').value.trim();
                  if(!ville) throw "Veuillez pr√©ciser la ville.";
                  detailsZone = ` / ${ville}`;
              } else {
                  detailsZone = ` / ${zone}`;
              }
          }

          // Statut & Identit√©
          const statut = statutSelect ? statutSelect.value : '';
          if(!statut) throw "Veuillez choisir votre statut.";

          const genre = el('genre').value;
          const nom = el('nomFamille').value.trim();
          const prenoms = el('prenoms').value.trim();
          if(!genre || !nom || !prenoms) throw "Veuillez remplir vos informations d'identit√© (Genre, Nom, Pr√©noms).";

          // Info Structure et Poste
          let infoPro = "";
          const nomStructure = el('nomStructure').value.trim();
          const posteVal = el('poste') ? el('poste').value : '';
          let posteFinal = posteVal === 'personnaliser' ? el('posteAutre').value.trim() : posteVal;

          if(statut === 'ecole') {
              const typeEco = el('typeEcole').value;
              if(!typeEco) throw "Veuillez pr√©ciser Type d'√©cole.";
              if(!nomStructure) throw "Veuillez pr√©ciser le nom de l'√©cole.";
              if(!posteFinal) throw "Veuillez pr√©ciser votre poste.";
              infoPro = `√âcole : ${nomStructure} (${typeEco})\nPoste : ${posteFinal}`;
          }
          else if(['librairie', 'bibliotheque'].includes(statut)) {
              if(!nomStructure) throw "Veuillez pr√©ciser le nom de l'√©tablissement.";
              if(!posteFinal) throw "Veuillez pr√©ciser votre poste.";
              infoPro = `√âtablissement : ${nomStructure}\nPoste : ${posteFinal}`;
          }
          else if(statut === 'psy') {
              if(!nomStructure) throw "Veuillez pr√©ciser le nom du Cabinet.";
              infoPro = `Cabinet : ${nomStructure}`;
          }

          // Contact
          const adresse = el('adresse').value.trim();
          if(!adresse) throw "Veuillez renseigner l'adresse.";

          const numTel = el('contactTel').value.trim();
          if(!numTel) throw "Veuillez renseigner le num√©ro de contact.";
          // Verif longueur
          const conf = configTel[pays];
          if(conf && conf.len > 0 && numTel.length !== conf.len) {
              throw `Le num√©ro pour ${pays} doit comporter ${conf.len} chiffres.`;
          }
          const fullTel = (el('indicatif').textContent) + numTel;

          const email = el('emailContact').value.trim();
          if(!email) throw "Veuillez renseigner l'e-mail.";

          // Commande
          const qte = getQuantite();
          if(qte <= 0) throw "Quantit√© invalide.";
          const total = el('total').value;
          if(!total) throw "Total non calcul√©.";

          // CONSTRUCTION MESSAGE
          const resume = 
            `*Nouvelle Commande - √âditions Nubi*\n` +
            `--------------------------------\n` +
            `üìç LIEU : ${pays}${detailsZone}\n` +
            `üë§ CLIENT : ${statut.toUpperCase()}\n` +
            `Identit√© : ${genre} ${prenoms} ${nom.toUpperCase()}\n` +
            (infoPro ? `${infoPro}\n` : '') +
            `üè† Adresse : ${adresse}\n` +
            `üìû Contact : ${fullTel}\n` +
            `üìß E-mail : ${email}\n` +
            `--------------------------------\n` +
            `üìñ LIVRE : Le Petit Nuage Qui Avait Peur de Pleuvoir\n` +
            `üì¶ QUANTIT√â : ${qte}\n` +
            `üí∞ TOTAL : ${total}\n` +
            `--------------------------------\n`;

          if(modeEnvoi === 'whatsapp') {
              const texteEncoded = encodeURIComponent(resume + "Bonjour, je souhaite valider cette commande.");
              window.open(`https://wa.me/${WHATSAPP_DESTINATION}?text=${texteEncoded}`, '_blank');
              confirmationTexte.textContent = "WhatsApp s'est ouvert. Envoyez le message pour valider.";
          } else {
              const sub = encodeURIComponent("Commande Livre - √âditions Nubi");
              const body = encodeURIComponent(resume + "\nMerci de bien vouloir traiter ma commande.");
              window.location.href = `mailto:${EMAIL_DESTINATION}?subject=${sub}&body=${body}`;
              confirmationTexte.textContent = "Votre application E-mail va s'ouvrir. Envoyez le mail pour valider.";
          }

          if(commandeForm) hide('commandeForm');
          if(confirmationCard) show('confirmationCard');
          location.hash = '#commande';

      } catch(e) {
          if(msgInfo) {
             msgInfo.textContent = e;
             msgInfo.style.color = "red";
          } else alert(e);
      }
  }

  const btnWa = el('btnWhatsapp');
  const btnEm = el('btnEmail');
  if(btnWa) btnWa.addEventListener('click', () => traiterEnvoi('whatsapp'));
  if(btnEm) btnEm.addEventListener('click', () => traiterEnvoi('email'));

  // Init
  updateFormFields();
});
</script>
</body>
</html>
